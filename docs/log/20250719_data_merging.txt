â¯ uvrun python src/data_preparation/merge_datasets.py
ğŸ§¬ Protein Similarity Analysis Pipeline
==================================================
Available modes:
1. Test mode (recommended first) - 1M rows per dataset
2. Full mode - Complete datasets

ğŸ§¬ PROTEIN SIMILARITY ANALYSIS PIPELINE
======================================================================
ğŸš€ FULL MODE: Processing complete datasets

ğŸ“ Configuration:
   MMSeqs2 TSV:     data/interm/sprot_pre2024/mmseqs/sprot_all_vs_all.tsv
   FoldComp TSV:    data/interm/sprot_pre2024/foldcomp/plddt.tsv
   FoldSeek TSV:    data/interm/sprot_pre2024/foldseek/afdb_swissprot_v4_all_vs_all.tsv
   Plots output:    out/data_analysis
   Final merged:    data/final/merged_protein_similarity.parquet

ğŸ”„ Processing MMSeqs2 data...
ğŸ“– Loaded parquet: data/interm/sprot_pre2024/mmseqs/sprot_all_vs_all.parquet
ğŸ—‘ï¸  MMSeqs2: Removed 542,238 self-matches
ğŸ§® Computing HFSP scores...
ğŸ“Š MMSeqs2 final shape: (101948593, 12)

ğŸ”„ Processing FoldComp data...
ğŸ“Š FoldComp final shape: (542378, 4)

ğŸ’¾ Saving low confidence protein IDs...
ğŸ’¾ Saved 47,264 low confidence IDs

ğŸ”„ Processing FoldSeek data...
ğŸ“– Loaded parquet: data/interm/sprot_pre2024/foldseek/afdb_swissprot_v4_all_vs_all.parquet
ğŸ—‘ï¸  FoldSeek: Removed 539,280 self-matches
ğŸ—‘ï¸  Removed 14,288,242 rows with low confidence structures (5.2%)
ğŸ“Š FoldSeek final shape: (262054054, 4)

ğŸ“Š Creating distribution plots...
ğŸ“Š Skipping existing plot: mmseqs_coverage.png
ğŸ“Š Skipping existing plot: mmseqs_pide.png
ğŸ“Š Skipping existing plot: mmseqs_hfsp.png
ğŸ“Š Skipping existing plot: foldcomp_plddt.png
ğŸ“Š Skipping existing plot: foldseek_coverage.png
ğŸ“Š Skipping existing plot: foldseek_tmscore.png
ğŸ“Š Created 1 new plots, 6 already existed in out/data_analysis

ğŸ”— Applying thresholds and merging datasets...
ğŸ¯ MMSeqs2 thresholds: 28,619,136 removed (28.1%), 73,329,457 retained
ğŸ¯ FoldSeek thresholds: 76,370,911 removed (29.1%), 185,683,143 retained
ğŸ“Š Pre-merge statistics:
   MMSeqs2 filtered: 73,329,457 rows
   FoldSeek filtered: 185,683,143 rows
ğŸ” MMSeqs2 columns: ['query', 'target', 'fident', 'hfsp']
ğŸ” FoldSeek columns: ['query', 'target', 'alntmscore']

ğŸ“ˆ Merge results:
   Total unique pairs: 188,021,387
   ğŸ¯ Matches found in both datasets: 70,991,213 (37.8%)
   ğŸ“Š MMSeqs2 only: 2,338,244 (1.2%)
   ğŸ” FoldSeek only: 114,691,930 (61.0%)
   ğŸ”— Overlap rate: 37.8%

ğŸ” Final dataset columns: ['query', 'target', 'fident', 'hfsp', 'alntmscore']

======================================================================
âœ… ANALYSIS COMPLETE!
======================================================================
ğŸ“Š Final dataset: 188,021,387 rows Ã— 5 columns
ğŸ“ˆ Plots saved to: out/data_analysis/
ğŸ’¾ Dataset saved to: data/final/merged_protein_similarity.parquet
ğŸ” Final columns: ['query', 'target', 'fident', 'hfsp', 'alntmscore']
Rows with both HFSP and alnTMscore present:
shape: (5, 5)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ query      â”† target     â”† fident â”† hfsp      â”† alntmscore â”‚
â”‚ ---        â”† ---        â”† ---    â”† ---       â”† ---        â”‚
â”‚ str        â”† str        â”† f64    â”† f64       â”† f64        â”‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•¡
â”‚ A0A009IHW8 â”† C0RGW8     â”† 0.422  â”† 40.911072 â”† 0.5305     â”‚
â”‚ A0A023FBW7 â”† A0A023FDY8 â”† 0.966  â”† 90.360178 â”† 0.7406     â”‚
â”‚ A0A023FBW7 â”† A0A023FFB5 â”† 0.483  â”† 41.976034 â”† 0.7246     â”‚
â”‚ A0A023FBW7 â”† A0A023G9N9 â”† 0.369  â”† 29.545209 â”† 0.7956     â”‚
â”‚ A0A023FBW7 â”† A0A0C9S461 â”† 0.327  â”† 25.240826 â”† 0.6032     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
shape: (5, 5)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ query      â”† target     â”† fident â”† hfsp      â”† alntmscore â”‚
â”‚ ---        â”† ---        â”† ---    â”† ---       â”† ---        â”‚
â”‚ str        â”† str        â”† f64    â”† f64       â”† f64        â”‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•¡
â”‚ A0A009IHW8 â”† A1AY86     â”† null   â”† null      â”† 0.6487     â”‚
â”‚ A0A009IHW8 â”† C0RGW8     â”† 0.422  â”† 40.911072 â”† 0.5305     â”‚
â”‚ A0A009IHW8 â”† P0DTS9     â”† null   â”† null      â”† 0.5615     â”‚
â”‚ A0A023FBW7 â”† A0A023FDY8 â”† 0.966  â”† 90.360178 â”† 0.7406     â”‚
â”‚ A0A023FBW7 â”† A0A023FFB5 â”† 0.483  â”† 41.976034 â”† 0.7246     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
âœ… Pipeline completed successfully!
ğŸ“Š Final dataset shape: (188021387, 5)